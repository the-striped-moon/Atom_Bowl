<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Atom Bowl ‚Äî Practice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="favicon.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0b0f14;
      --panel: #121824;
      --accent: #4f7cff;
      --text: #e6eaf0;
      --muted: #9aa4b2;
      --good: #39d98a;
      --bad: #ff6b6b;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }

    /* Ambient animated backdrop */
    body::before {
      content: "";
      position: fixed;
      inset: -20vh -20vw;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(79,124,255,0.28), transparent 55%),
        radial-gradient(700px 420px at 80% 20%, rgba(57,217,138,0.14), transparent 60%),
        radial-gradient(900px 520px at 60% 90%, rgba(255,107,107,0.12), transparent 62%);
      filter: blur(18px);
      opacity: 0.9;
      animation: drift 14s ease-in-out infinite alternate;
      z-index: -2;
      pointer-events: none;
    }

    @keyframes drift {
      from { transform: translate3d(-1.2%, -0.8%, 0) scale(1); }
      to   { transform: translate3d( 1.2%,  0.9%, 0) scale(1.02); }
    }

    /* bottom wave */
    .waves {
      position: fixed;
      left: 0;
      right: 0;
      bottom: -2px;
      height: 170px;
      z-index: -1;
      pointer-events: none;
      opacity: 0.55;
    }

    .waves svg {
      width: 120%;
      height: 100%;
      transform: translateX(-8%);
    }

    .wave1 { animation: waveMove 10s ease-in-out infinite; }
    .wave2 { animation: waveMove 14s ease-in-out infinite reverse; opacity: 0.7; }

    @keyframes waveMove {
      0%   { transform: translateX(-8%); }
      50%  { transform: translateX(-2%); }
      100% { transform: translateX(-8%); }
    }

    /* NAV */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 280px;
      background: var(--panel);
      padding: 24px 24px 48px;
      transform: translateX(-100%);
      transition: transform 0.42s cubic-bezier(.2,.9,.2,1);
      z-index: 1000;
    }

    .nav.open { transform: translateX(0); }

    .nav-title {
      font-weight: 700;
      font-size: 1.4rem;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav a {
      display: flex;
      align-items: center;
      gap: 14px;
      margin: 12px 0;
      padding: 12px 14px;
      border-radius: 12px;
      color: var(--text);
      text-decoration: none;
      font-weight: 500;
      transition: background 0.25s, color 0.25s, transform 0.15s;
    }

    .nav a:hover {
      background: rgba(79, 124, 255, 0.15);
      color: var(--accent);
      transform: translateX(4px);
    }

    .icon { width: 22px; text-align: center; }

    .hamburger {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 28px;
      cursor: pointer;
      z-index: 1100;
      user-select: none;
      transition: left 0.35s ease;
    }

    .hamburger.open { left: 300px; }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.42s cubic-bezier(.2,.9,.2,1);
      z-index: 900;
    }

    .overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* MAIN */
    .main {
      padding: 100px 24px 120px;
      max-width: 1100px;
      margin: auto;
      min-height: 100vh;
    }

    .header {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 22px;
    }

    .title {
      font-size: 2.3rem;
      font-weight: 800;
      letter-spacing: 0.2px;
      margin: 0;
    }

    .subtitle {
      margin: 6px 0 0;
      color: var(--muted);
      font-weight: 500;
    }

    .panel {
      background: linear-gradient(145deg, rgba(20,27,46,0.95), rgba(15,21,36,0.92));
      border-radius: 20px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      backdrop-filter: blur(8px);
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .field { display: grid; gap: 6px; }

    label {
      font-size: 0.82rem;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: 0.2px;
    }

    select, input {
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(18,24,36,0.92);
      color: var(--text);
      outline: none;
      font-weight: 600;
    }

    select:focus, input:focus {
      border-color: rgba(79,124,255,0.55);
      box-shadow: 0 0 0 6px rgba(79,124,255,0.10);
    }

    /* Category checkboxes */
    .cat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 4px;
    }

    .cat {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(18,24,36,0.9);
      border: 1px solid rgba(255,255,255,0.08);
      font-weight: 700;
      cursor: pointer;
      transition: border-color .15s, filter .15s, transform .12s;
      user-select: none;
    }

    .cat:hover {
      transform: translateY(-1px);
      border-color: rgba(79,124,255,0.35);
      filter: brightness(1.06);
    }

    .cat input {
      accent-color: var(--accent);
      transform: scale(1.1);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 18px;
      margin-top: 18px;
    }

    .tile {
      background: linear-gradient(145deg, rgba(27,36,64,0.9), rgba(15,21,36,0.92));
      border-radius: 20px;
      padding: 22px;
      border: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
      transition: transform 0.2s ease, border-color 0.2s ease, filter 0.2s ease;
      min-height: 150px;
      display: grid;
      gap: 10px;
    }

    .tile:hover {
      transform: translateY(-3px);
      border-color: rgba(79,124,255,0.35);
      filter: brightness(1.05);
    }

    .tile .top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .badge {
      font-size: 0.78rem;
      font-weight: 800;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(79,124,255,0.14);
      border: 1px solid rgba(79,124,255,0.26);
      color: var(--text);
    }

    .tile h3 {
      margin: 0;
      font-size: 1.15rem;
      font-weight: 800;
    }

    .tile p {
      margin: 0;
      color: var(--muted);
      line-height: 1.45;
      font-weight: 550;
    }

    .count {
      margin-top: 6px;
      color: rgba(230,234,240,0.9);
      font-weight: 800;
      letter-spacing: 0.2px;
    }

    .mini {
      margin-top: 10px;
      color: var(--muted);
      font-weight: 650;
      font-size: 0.9rem;
    }

    @media (max-width: 860px) {
      .controls { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @media (max-width: 520px) {
      .controls { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <div class="waves" aria-hidden="true">
    <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
      <path class="wave1" fill="rgba(79,124,255,0.20)" d="M0,224L48,229.3C96,235,192,245,288,229.3C384,213,480,171,576,154.7C672,139,768,149,864,176C960,203,1056,245,1152,250.7C1248,256,1344,224,1392,208L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
      <path class="wave2" fill="rgba(57,217,138,0.10)" d="M0,256L60,229.3C120,203,240,149,360,138.7C480,128,600,160,720,170.7C840,181,960,171,1080,186.7C1200,203,1320,245,1380,266.7L1440,288L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path>
    </svg>
  </div>

  <div class="nav" id="nav">
    <h2 class="nav-title">‚öõ Atom Bowl</h2>
    <a href="index.html"><span class="icon">üè†</span> Home</a>
    <a href="generate.html"><span class="icon">‚ú®</span> Generate</a>
    <a href="practice_home.html"><span class="icon">‚ö°</span> Practice</a>
    <a href="question_bank.html"><span class="icon">üìö</span> Question Bank</a>
    <a href="settings.html"><span class="icon">‚öôÔ∏è</span> Settings</a>
  </div>

  <div class="overlay" id="overlay"></div>
  <div class="hamburger" id="hamburger">‚ò∞</div>

  <div class="main">
    <div class="header">
      <div>
        <h1 class="title">Practice</h1>
        <div class="subtitle">Pick a mode, pick a topic, then go full buzzer-goblin.</div>
      </div>
      <div class="panel" style="padding:14px 16px; min-width: 260px;">
        <div style="display:flex;justify-content:space-between;gap:10px;align-items:center;">
          <div style="font-weight:800;">Loaded Bank</div>
          <div class="badge" id="bankStatus">Checking‚Ä¶</div>
        </div>
        <div class="mini" id="bankMeta">questions.json</div>
      </div>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
        <div style="font-weight:800;font-size:1.05rem;">Filters</div>
        <div class="mini">These apply to every tile below.</div>
      </div>

      <div class="controls">
        <div class="field">
          <label for="level">Division</label>
          <select id="level">
            <option value="ANY">Any</option>
            <option value="MS">Middle School</option>
            <option value="HS">High School</option>
          </select>
        </div>

        <div class="field">
  <label for="category">Category</label>
  <select id="category">
    <option value="ANY">Any</option>
    <option value="EARTH SCIENCE">Earth Science</option>
    <option value="EARTH AND SPACE">Earth & Space</option>
    <option value="EARTH AND SPACE SCIENCE">Earth & Space Science</option>
    <option value="ASTRONOMY">Astronomy</option>
    <option value="BIOLOGY">Biology</option>
    <option value="LIFE SCIENCE">Life Science</option>
    <option value="CHEMISTRY">Chemistry</option>
    <option value="PHYSICS">Physics</option>
    <option value="PHYSICAL SCIENCE">Physical Science</option>
    <option value="GENERAL SCIENCE">General Science</option>
    <option value="ENERGY">Energy</option>
    <option value="MATH">Math</option>
    <option value="MATHEMATICS">Mathematics</option>
  </select>
</div>
        </div>

        <div class="field">
          <label for="qaType">Question Type</label>
          <select id="qaType">
            <option value="ANY">Both (SA + WXYZ)</option>
            <option value="SA">Short Answer (SA)</option>
            <option value="MC">Multiple Choice (WXYZ)</option>
          </select>
        </div>

        <div class="field">
          <label for="bonus">Toss-up / Bonus</label>
          <select id="bonus">
            <option value="ANY">Any</option>
            <option value="false">Toss-ups only</option>
            <option value="true">Bonuses only</option>
          </select>
        </div>

        <div class="field">
          <label for="count">Questions per run</label>
          <input id="count" type="number" min="5" max="100" step="5" value="25" />
        </div>

        <div class="field">
          <label for="seconds">Seconds per question</label>
          <input id="seconds" type="number" min="5" max="30" step="1" value="10" />
        </div>

        <div class="field" style="grid-column: span 2;">
          <label for="setName">Set name (optional)</label>
          <input id="setName" placeholder="e.g., Sample-Set-1 (leave blank for any)" />
        </div>

        <div class="field" style="grid-column: span 2;">
          <label for="roundName">Round name (optional)</label>
          <input id="roundName" placeholder="e.g., round10 (leave blank for any)" />
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="tile" onclick="startRun('rapid')">
        <div class="top">
          <h3>‚ö° Rapid Fire</h3>
          <span class="badge">Fast</span>
        </div>
        <p>Classic continuous practice: buzz, answer, next, repeat. Uses your filters.</p>
        <div class="count" id="countRapid">‚Äî</div>
      </div>

      <div class="tile" onclick="startRun('tossup')">
        <div class="top">
          <h3>üéØ Toss-ups</h3>
          <span class="badge">No bonuses</span>
        </div>
        <p>Only toss-ups. Great for buzzer speed and accuracy.</p>
        <div class="count" id="countToss">‚Äî</div>
      </div>

      <div class="tile" onclick="startRun('bonus')">
        <div class="top">
          <h3>üß© Bonuses</h3>
          <span class="badge">Harder</span>
        </div>
        <p>Only bonuses. Train deeper content + multi-step thinking.</p>
        <div class="count" id="countBonus">‚Äî</div>
      </div>

      <div class="tile" onclick="startRun('wxyz')">
        <div class="top">
          <h3>üî† WXYZ Sprint</h3>
          <span class="badge">MC only</span>
        </div>
        <p>Multiple choice only. Buzz then click W/X/Y/Z (or press the key).</p>
        <div class="count" id="countMC">‚Äî</div>
      </div>

      <div class="tile" onclick="startRun('sa')">
        <div class="top">
          <h3>‚úçÔ∏è Short Answer Drill</h3>
          <span class="badge">SA only</span>
        </div>
        <p>Short answer only. Buzz then type and hit Enter or Submit.</p>
        <div class="count" id="countSA">‚Äî</div>
      </div>

      <div class="tile" onclick="startRun('set')">
        <div class="top">
          <h3>üì¶ Run a Set</h3>
          <span class="badge">By name</span>
        </div>
        <p>Use set_name and/or round_name fields above to run something specific.</p>
        <div class="count" id="countSet">‚Äî</div>
      </div>
    </div>

  </div>

  <script>
    // Everything waits for DOM so we never attach listeners to null nodes.
    document.addEventListener('DOMContentLoaded', () => {
      // NAV
      const nav = document.getElementById('nav');
      const overlay = document.getElementById('overlay');
      const hamburger = document.getElementById('hamburger');

      function toggleNav() {
        const isOpen = nav.classList.toggle('open');
        overlay.classList.toggle('show');
        hamburger.classList.toggle('open');
        hamburger.textContent = isOpen ? '‚úï' : '‚ò∞';
      }

      hamburger.addEventListener('click', toggleNav);
      overlay.addEventListener('click', toggleNav);

      // Filters
      const els = {
        level: document.getElementById('level'),
        category: document.getElementById('category'),
        qaType: document.getElementById('qaType'),
        bonus: document.getElementById('bonus'),
        count: document.getElementById('count'),
        seconds: document.getElementById('seconds'),
        setName: document.getElementById('setName'),
        roundName: document.getElementById('roundName'),
        bankStatus: document.getElementById('bankStatus'),
        bankMeta: document.getElementById('bankMeta'),
        countRapid: document.getElementById('countRapid'),
        countToss: document.getElementById('countToss'),
        countBonus: document.getElementById('countBonus'),
        countMC: document.getElementById('countMC'),
        countSA: document.getElementById('countSA'),
        countSet: document.getElementById('countSet'),
      };

      // Minimal self-tests (console only)
      console.assert(!!els.level && !!els.category && !!els.qaType && !!els.bonus, 'Missing core filter elements');
      console.assert(!!els.countRapid && !!els.bankStatus, 'Missing status/count elements');

      let bank = [];

      function normCat(c) { return String(c || '').trim(); }

      
      function applyFilters(list, overrides = {}) {
        const level = overrides.level ?? els.level.value;
        const category = overrides.category ?? els.category.value;
        const qaType = overrides.qaType ?? els.qaType.value;
        const bonus = overrides.bonus ?? els.bonus.value;
        const setName = (overrides.setName ?? els.setName.value).trim();
        const roundName = (overrides.roundName ?? els.roundName.value).trim();

        return list.filter(q => {
          if (level !== 'ANY' && q.level !== level) return false;
          if (category !== 'ANY' && normCat(q.category) !== category) return false;
          if (qaType !== 'ANY' && q.type !== qaType) return false;
          if (bonus !== 'ANY' && String(!!q.bonus) !== bonus) return false;
          if (setName && q.set_name !== setName) return false;
          if (roundName && q.round_name !== roundName) return false;
          return true;
        });
      }

      function updateCounts() {
        const base = applyFilters(bank);
        els.countRapid.textContent = `${base.length.toLocaleString()} matches`;
        els.countToss.textContent = `${applyFilters(bank, { bonus: 'false' }).length.toLocaleString()} matches`;
        els.countBonus.textContent = `${applyFilters(bank, { bonus: 'true' }).length.toLocaleString()} matches`;
        els.countMC.textContent = `${applyFilters(bank, { qaType: 'MC' }).length.toLocaleString()} matches`;
        els.countSA.textContent = `${applyFilters(bank, { qaType: 'SA' }).length.toLocaleString()} matches`;
        els.countSet.textContent = `${applyFilters(bank).length.toLocaleString()} matches`;
      }

      function getRunConfig(mode) {
        const cfg = {
          mode,
          level: els.level.value,
          category: getSelectedCategories(),
          qaType: els.qaType.value,
          bonus: els.bonus.value,
          count: Math.max(1, parseInt(els.count.value || '25', 10)),
          seconds: Math.max(5, Math.min(30, parseInt(els.seconds.value || '10', 10))),
          setName: els.setName.value.trim(),
          roundName: els.roundName.value.trim(),
        };

        // Tile-specific rules
        if (mode === 'tossup') cfg.bonus = 'false';
        if (mode === 'bonus') cfg.bonus = 'true';
        if (mode === 'wxyz') cfg.qaType = 'MC';
        if (mode === 'sa') cfg.qaType = 'SA';

        return cfg;
      }

      // Expose startRun for onclick tiles
      window.startRun = function startRun(mode) {
        localStorage.setItem('atom_run', JSON.stringify(getRunConfig(mode)));
        window.location.href = 'practice.html';
      };

      async function loadBank() {
        try {
          els.bankStatus.textContent = 'Loading‚Ä¶';
          const res = await fetch('./questions.json', { cache: 'no-store' });
          if (!res.ok) throw new Error('questions.json not found');
          const data = await res.json();
          bank = Array.isArray(data) ? data : (data.questions || []);

          els.bankStatus.textContent = 'Ready';
          els.bankStatus.style.background = 'rgba(57,217,138,0.14)';
          els.bankStatus.style.borderColor = 'rgba(57,217,138,0.24)';
          els.bankMeta.textContent = `${bank.length.toLocaleString()} questions detected`;

          updateCounts();
        } catch (e) {
          els.bankStatus.textContent = 'Missing';
          els.bankStatus.style.background = 'rgba(255,107,107,0.14)';
          els.bankStatus.style.borderColor = 'rgba(255,107,107,0.22)';
          els.bankMeta.textContent = 'Put questions.json in the repo root (same folder as this file).';
          bank = [];
          updateCounts();
        }
      }

      // Live counts
      const watch = [els.level, els.qaType, els.bonus, els.count, els.seconds, els.setName, els.roundName];
      for (const el of watch) {
        // Some are inputs, some are selects
        el.addEventListener('change', updateCounts);
        el.addEventListener('input', updateCounts);
      }
      els.category.addEventListener('change', updateCounts);

      loadBank();
    });
  </script>
</body>
</html>
