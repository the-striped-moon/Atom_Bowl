<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Atom Bowl ‚Äî Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="favicon.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0b0f14;
      --panel: #121824;
      --panel2: rgba(18,24,36,0.82);
      --accent: #4f7cff;
      --text: #e6eaf0;
      --muted: #9aa4b2;
      --good: #39d98a;
      --bad: #ff6b6b;
      --warn: #f7c948;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: -20vh -20vw;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(79,124,255,0.28), transparent 55%),
        radial-gradient(700px 420px at 80% 20%, rgba(57,217,138,0.14), transparent 60%),
        radial-gradient(900px 520px at 60% 90%, rgba(255,107,107,0.12), transparent 62%);
      filter: blur(18px);
      opacity: 0.9;
      animation: drift 14s ease-in-out infinite alternate;
      z-index: -2;
      pointer-events: none;
    }

    @keyframes drift {
      from { transform: translate3d(-1.2%, -0.8%, 0) scale(1); }
      to   { transform: translate3d( 1.2%,  0.9%, 0) scale(1.02); }
    }

    .waves {
      position: fixed;
      left: 0;
      right: 0;
      bottom: -2px;
      height: 170px;
      z-index: -1;
      pointer-events: none;
      opacity: 0.55;
    }

    .waves svg {
      width: 120%;
      height: 100%;
      transform: translateX(-8%);
    }

    .wave1 { animation: waveMove 10s ease-in-out infinite; }
    .wave2 { animation: waveMove 14s ease-in-out infinite reverse; opacity: 0.7; }

    @keyframes waveMove {
      0%   { transform: translateX(-8%); }
      50%  { transform: translateX(-2%); }
      100% { transform: translateX(-8%); }
    }

    /* NAV */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 280px;
      background: var(--panel);
      padding: 24px 24px 48px;
      transform: translateX(-100%);
      transition: transform 0.42s cubic-bezier(.2,.9,.2,1);
      z-index: 1000;
    }

    .nav.open { transform: translateX(0); }

    .nav-title {
      font-weight: 800;
      font-size: 1.4rem;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav a {
      display: flex;
      align-items: center;
      gap: 14px;
      margin: 12px 0;
      padding: 12px 14px;
      border-radius: 12px;
      color: var(--text);
      text-decoration: none;
      font-weight: 650;
      transition: background 0.25s, color 0.25s, transform 0.15s;
    }

    .nav a:hover {
      background: rgba(79, 124, 255, 0.15);
      color: var(--accent);
      transform: translateX(4px);
    }

    .icon { width: 22px; text-align: center; }

    .hamburger {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 28px;
      cursor: pointer;
      z-index: 1100;
      user-select: none;
      transition: left 0.35s ease;
    }

    .hamburger.open { left: 300px; }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.42s cubic-bezier(.2,.9,.2,1);
      z-index: 900;
    }

    .overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Page */
    .main {
      padding: 112px 24px 140px;
      max-width: 1100px;
      margin: auto;
      min-height: 100vh;
    }

    .header {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }

    .title {
      font-size: 2.0rem;
      font-weight: 900;
      letter-spacing: -0.02em;
      margin: 0;
    }

    .subtitle {
      margin: 6px 0 0;
      color: var(--muted);
      font-weight: 750;
    }

    .cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 18px;
    }

    @media (max-width: 900px) {
      .cards { grid-template-columns: 1fr; }
    }

    .card {
      background: linear-gradient(145deg, rgba(20,27,46,0.95), rgba(15,21,36,0.92));
      border-radius: 18px;
      padding: 16px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 16px 50px rgba(0,0,0,0.30);
      backdrop-filter: blur(8px);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -60px;
      background: radial-gradient(260px 180px at 20% 10%, rgba(79,124,255,0.20), transparent 60%);
      opacity: 0.6;
      pointer-events: none;
    }

    .card h3 {
      margin: 0 0 10px;
      font-weight: 900;
      letter-spacing: -0.01em;
      position: relative;
      z-index: 1;
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 12px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(18,24,36,0.55);
      position: relative;
      z-index: 1;
      margin-bottom: 10px;
    }

    .row:last-child { margin-bottom: 0; }

    .label {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .label b { font-weight: 900; }
    .label span { color: var(--muted); font-weight: 700; font-size: 0.92rem; }

    .select, .input {
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(18,24,36,0.85);
      color: var(--text);
      outline: none;
      font-weight: 800;
      min-width: 170px;
    }

    .select:focus, .input:focus {
      border-color: rgba(79,124,255,0.55);
      box-shadow: 0 0 0 6px rgba(79,124,255,0.10);
    }

    .toggle {
      width: 54px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
      position: relative;
      cursor: pointer;
      transition: filter .15s, background .15s;
      flex: 0 0 auto;
    }

    .toggle:hover { filter: brightness(1.07); }

    .knob {
      position: absolute;
      top: 50%;
      left: 4px;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: rgba(230,234,240,0.92);
      box-shadow: 0 10px 26px rgba(0,0,0,0.35);
      transition: left .18s ease, background .18s ease;
    }

    .toggle.on {
      background: rgba(57,217,138,0.18);
      border-color: rgba(57,217,138,0.30);
    }

    .toggle.on .knob {
      left: 26px;
      background: rgba(57,217,138,0.92);
    }

    .btnrow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 14px;
    }

    .btn {
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(79,124,255,0.16);
      color: var(--text);
      font-weight: 900;
      cursor: pointer;
      transition: transform .15s, filter .15s;
    }

    .btn:hover { transform: translateY(-1px); filter: brightness(1.07); }

    .btn.danger {
      background: rgba(255,107,107,0.14);
      border-color: rgba(255,107,107,0.20);
    }

    .toast {
      position: fixed;
      right: 16px;
      bottom: 18px;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(18,24,36,0.92);
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: 0 22px 60px rgba(0,0,0,0.45);
      color: var(--text);
      font-weight: 900;
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 2000;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .pop { animation: popIn 220ms cubic-bezier(.2,.9,.2,1) both; }
    @keyframes popIn {
      from { opacity: 0; transform: translateY(8px) scale(0.99); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }
  </style>
</head>
<body>

  <div class="waves" aria-hidden="true">
    <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
      <path class="wave1" fill="rgba(79,124,255,0.20)" d="M0,224L48,229.3C96,235,192,245,288,229.3C384,213,480,171,576,154.7C672,139,768,149,864,176C960,203,1056,245,1152,250.7C1248,256,1344,224,1392,208L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
      <path class="wave2" fill="rgba(57,217,138,0.10)" d="M0,256L60,229.3C120,203,240,149,360,138.7C480,128,600,160,720,170.7C840,181,960,171,1080,186.7C1200,203,1320,245,1380,266.7L1440,288L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path>
    </svg>
  </div>

  <!-- NAV -->
  <div class="nav" id="nav">
    <h2 class="nav-title">‚öõ Atom Bowl</h2>
    <a href="index.html"><span class="icon">üè†</span> Home</a>
    <a href="generate.html"><span class="icon">‚ú®</span> Generate</a>
    <a href="practice_home.html"><span class="icon">‚ö°</span> Practice</a>
    <a href="question_bank.html"><span class="icon">üìö</span> Question Bank</a>
    <a href="settings.html"><span class="icon">‚öôÔ∏è</span> Settings</a>
  </div>

  <div class="overlay" id="overlay"></div>
  <div class="hamburger" id="hamburger">‚ò∞</div>

  <div class="main">
    <div class="header">
      <div class="pop">
        <h1 class="title">Settings</h1>
        <div class="subtitle">Preferences are stored locally in your browser (no backend needed).</div>
      </div>
    </div>

    <div class="cards">
      <div class="card pop">
        <h3>Practice</h3>

        <div class="row">
          <div class="label">
            <b>Sound FX</b>
            <span>Buzz + click sounds.</span>
          </div>
          <div class="toggle" id="sfxToggle" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
        </div>

        <div class="row">
          <div class="label">
            <b>Read Aloud</b>
            <span>Browser voice reads the question.</span>
          </div>
          <div class="toggle" id="ttsToggle" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
        </div>

        <div class="row">
          <div class="label">
            <b>Default Division</b>
            <span>Used as the starter choice on Practice Home.</span>
          </div>
          <select class="select" id="divSelect">
            <option value="MS">MS</option>
            <option value="HS">HS</option>
          </select>
        </div>

        <div class="row">
          <div class="label">
            <b>Default Mode</b>
            <span>Rapid vs Regular practice.</span>
          </div>
          <select class="select" id="modeSelect">
            <option value="rapid">rapid</option>
            <option value="regular">regular</option>
          </select>
        </div>
      </div>

      <div class="card pop">
        <h3>UI</h3>

        <div class="row">
          <div class="label">
            <b>High Contrast</b>
            <span>Sharper borders + brighter text.</span>
          </div>
          <div class="toggle" id="hcToggle" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
        </div>

        <div class="row">
          <div class="label">
            <b>Animations</b>
            <span>Pop/fade effects across pages.</span>
          </div>
          <div class="toggle" id="animToggle" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
        </div>

        <div class="row">
          <div class="label">
            <b>Font Size</b>
            <span>Small / Medium / Large.</span>
          </div>
          <select class="select" id="fontSelect">
            <option value="m">Medium</option>
            <option value="s">Small</option>
            <option value="l">Large</option>
          </select>
        </div>

        <div class="row">
          <div class="label">
            <b>Accent Color</b>
            <span>Controls glow/hover color.</span>
          </div>
          <select class="select" id="accentSelect">
            <option value="#4f7cff">Blue (default)</option>
            <option value="#39d98a">Green</option>
            <option value="#ff6b6b">Red</option>
            <option value="#f7c948">Gold</option>
          </select>
        </div>
      </div>
    </div>

    <div class="btnrow">
      <button class="btn" id="apply">Save</button>
      <button class="btn danger" id="reset">Reset to Defaults</button>
      <a class="btn" href="index.html" style="text-decoration:none; display:inline-flex; align-items:center;">Back to Home</a>
    </div>
  </div>

  <div class="toast" id="toast">Saved ‚úÖ</div>

  <script>
    // NAV
    const nav = document.getElementById('nav');
    const overlay = document.getElementById('overlay');
    const hamburger = document.getElementById('hamburger');
    function toggleNav() {
      const isOpen = nav.classList.toggle('open');
      overlay.classList.toggle('show');
      hamburger.classList.toggle('open');
      hamburger.textContent = isOpen ? '‚úï' : '‚ò∞';
    }
    hamburger.addEventListener('click', toggleNav);
    overlay.addEventListener('click', toggleNav);

    // Settings model
    const DEFAULTS = {
      sfx: true,
      tts: true,
      div: 'MS',
      mode: 'rapid',
      highContrast: false,
      animations: true,
      fontSize: 'm',
      accent: '#4f7cff'
    };

    const KEY = 'atom_settings_v1';

    function loadSettings() {
      try {
        const raw = localStorage.getItem(KEY);
        if (!raw) return { ...DEFAULTS };
        const parsed = JSON.parse(raw);
        return { ...DEFAULTS, ...parsed };
      } catch {
        return { ...DEFAULTS };
      }
    }

    function saveSettings(s) {
      localStorage.setItem(KEY, JSON.stringify(s));
    }

    function setToggle(el, on) {
      el.classList.toggle('on', !!on);
      el.setAttribute('aria-checked', String(!!on));
    }

    function readToggle(el) {
      return el.classList.contains('on');
    }

    function wireToggle(el) {
      const flip = () => setToggle(el, !readToggle(el));
      el.addEventListener('click', flip);
      el.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          flip();
        }
      });
    }

    // Elements
    const sfxToggle = document.getElementById('sfxToggle');
    const ttsToggle = document.getElementById('ttsToggle');
    const hcToggle = document.getElementById('hcToggle');
    const animToggle = document.getElementById('animToggle');

    const divSelect = document.getElementById('divSelect');
    const modeSelect = document.getElementById('modeSelect');
    const fontSelect = document.getElementById('fontSelect');
    const accentSelect = document.getElementById('accentSelect');

    const toast = document.getElementById('toast');
    const applyBtn = document.getElementById('apply');
    const resetBtn = document.getElementById('reset');

    [sfxToggle, ttsToggle, hcToggle, animToggle].forEach(wireToggle);

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1200);
    }

    function applyThemePreview(s) {
      // Accent preview
      document.documentElement.style.setProperty('--accent', s.accent);

      // Font size preview
      const sizes = { s: '14px', m: '16px', l: '18px' };
      document.body.style.fontSize = sizes[s.fontSize] || '16px';

      // High contrast preview
      document.body.style.filter = s.highContrast ? 'contrast(1.06) saturate(1.02)' : 'none';
    }

    function hydrateUI(s) {
      setToggle(sfxToggle, s.sfx);
      setToggle(ttsToggle, s.tts);
      setToggle(hcToggle, s.highContrast);
      setToggle(animToggle, s.animations);
      divSelect.value = s.div;
      modeSelect.value = s.mode;
      fontSelect.value = s.fontSize;
      accentSelect.value = s.accent;
      applyThemePreview(s);
    }

    function collectUI() {
      return {
        sfx: readToggle(sfxToggle),
        tts: readToggle(ttsToggle),
        div: divSelect.value,
        mode: modeSelect.value,
        highContrast: readToggle(hcToggle),
        animations: readToggle(animToggle),
        fontSize: fontSelect.value,
        accent: accentSelect.value
      };
    }

    // Live preview on dropdowns
    [fontSelect, accentSelect].forEach(el => {
      el.addEventListener('change', () => {
        const s = collectUI();
        applyThemePreview(s);
      });
    });
    hcToggle.addEventListener('click', () => applyThemePreview(collectUI()));

    applyBtn.addEventListener('click', () => {
      const s = collectUI();
      saveSettings(s);
      applyThemePreview(s);
      showToast('Saved ‚úÖ');
    });

    resetBtn.addEventListener('click', () => {
      saveSettings({ ...DEFAULTS });
      hydrateUI({ ...DEFAULTS });
      showToast('Reset ‚úÖ');
    });

    // Init
    hydrateUI(loadSettings());
  </script>
</body>
</html>
